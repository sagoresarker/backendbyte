<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Race Condition between Database and Application in Docker Container | Backend Byte</title>
<meta name=keywords content="db"><meta name=description content="Exploring race conditions between database and application layers in Docker containers."><meta name=author content="Backend Byte"><link rel=canonical href=http://backendbyte.com/posts/2024-07-08-race-condition-docker/><link crossorigin=anonymous href=http://backendbyte.com/assets/css/stylesheet.20c194b929af751929546fb6a7752e20b0687bd8df8d51f0cfbfa0e70f13cda3.css integrity="sha256-IMGUuSmvdRkpVG+2p3UuILBoe9jfjVHwz7+g5w8TzaM=" rel="preload stylesheet" as=style><link rel=icon href=http://backendbyte.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://backendbyte.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://backendbyte.com/favicon-32x32.png><link rel=apple-touch-icon href=http://backendbyte.com/apple-touch-icon.png><link rel=mask-icon href=http://backendbyte.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://backendbyte.com/posts/2024-07-08-db-race-condition-notes-2024/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Race Condition between Database and Application in Docker Container"><meta property="og:description" content="Exploring race conditions between database and application layers in Docker containers."><meta property="og:type" content="article"><meta property="og:url" content="http://backendbyte.com/posts/2024-07-08-db-race-condition-notes-2024/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-08T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-08T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Race Condition between Database and Application in Docker Container"><meta name=twitter:description content="Exploring race conditions between database and application layers in Docker containers."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://backendbyte.com/posts/"},{"@type":"ListItem","position":2,"name":"Race Condition between Database and Application in Docker Container","item":"http://backendbyte.com/posts/2024-07-08-db-race-condition-notes-2024/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Race Condition between Database and Application in Docker Container","name":"Race Condition between Database and Application in Docker Container","description":"Exploring race conditions between database and application layers in Docker containers.","keywords":["db"],"articleBody":" In the realm of containerized applications, particularly those orchestrated with Docker, developers often encounter a subtle yet critical challenge: managing the startup sequence of interdependent services. One of the most common and potentially problematic scenarios is the race condition that can occur between a database container and an application container. This article will provide an in-depth exploration of this race condition, with a focus on Go-based applications, and offer strategies to mitigate it effectively.\nUnderstanding Race Conditions A race condition, in its essence, is a situation where the behavior of a system depends on the relative timing of events, particularly when those events don’t occur in the intended or expected order. In concurrent systems, race conditions often manifest when two or more operations must execute in a specific sequence to function correctly, but the system doesn’t guarantee this order.\nThe Database-Application Race Condition in Docker: A Deeper Look When deploying a multi-container Docker application, typically comprising a database (such as PostgreSQL or MySQL) and an application server (in our case, a Go application), you might encounter a scenario where your application fails to start due to an inability to connect to the database. This failure is a classic example of a race condition in containerized environments.\nTo understand why this occurs, let’s break down the startup process:\nConcurrent Initialization: When you start your Docker Compose setup or deploy your containers, Docker initiates the startup of all defined services concurrently. This parallel initialization is generally beneficial for reducing overall startup time.\nVarying Startup Times: Different containers have different initialization requirements. A database container, for instance, needs to perform several operations before it’s ready to accept connections:\nInitialize the database engine Load configuration files Allocate memory and resources Create or recover database files Start listening for connections On the other hand, an application container might only need to load its code into memory and start the server process.\nEager Application Initialization: Most application code is written with the assumption that all required services (like databases) are available when the application starts. As soon as the application container starts, it typically attempts to establish a connection to the database.\nTiming Mismatch: Due to the difference in startup times, the application container often becomes operational before the database container is ready to accept connections. When the application attempts to connect to the database, it encounters an error because the database service isn’t available yet.\nThis mismatch in timing - where the application is ready before its critical dependency (the database) - is the essence of the race condition we’re discussing.\nExample Scenario with Go Let’s illustrate this with a Go application that connects to a PostgreSQL database.\ndocker-compose.yml:\nversion: '3' services: db: image: postgres:13 environment: POSTGRES_DB: myapp POSTGRES_USER: user POSTGRES_PASSWORD: password app: build: . depends_on: - db environment: DATABASE_URL: postgres://user:password@db:5432/myapp?sslmode=disable main.go:\npackage main import ( \"database/sql\" \"fmt\" \"os\" \"time\" _ \"github.com/lib/pq\" ) func main() { dbURL := os.Getenv(\"DATABASE_URL\") db, err := sql.Open(\"postgres\", dbURL) if err != nil { fmt.Println(\"Error opening database connection:\", err) os.Exit(1) } defer db.Close() err = db.Ping() if err != nil { fmt.Println(\"Error connecting to the database:\", err) os.Exit(1) } fmt.Println(\"Successfully connected to the database\") } In this scenario, even though we’ve used depends_on in the Docker Compose file, our Go application might still attempt to connect before the PostgreSQL database is ready to accept connections. This will result in a connection error, exemplifying the race condition.\nStrategies to Mitigate the Race Condition 1. Implement Retry Logic One robust approach is to implement retry logic in your Go application. This method allows your application to gracefully handle initial connection failures and retry until the database becomes available.\nUpdated main.go:\npackage main import ( \"database/sql\" \"fmt\" \"os\" \"time\" _ \"github.com/lib/pq\" ) func main() { dbURL := os.Getenv(\"DATABASE_URL\") db, err := connectWithRetry(dbURL) if err != nil { fmt.Println(\"Failed to connect to database:\", err) os.Exit(1) } defer db.Close() fmt.Println(\"Successfully connected to the database\") } func connectWithRetry(dbURL string) (*sql.DB, error) { var db *sql.DB var err error maxRetries := 5 retryDelay := time.Second * 5 for i := 0; i \u003c maxRetries; i++ { db, err = sql.Open(\"postgres\", dbURL) if err != nil { fmt.Printf(\"Error opening database connection (attempt %d/%d): %v\\n\", i+1, maxRetries, err) time.Sleep(retryDelay) continue } err = db.Ping() if err == nil { return db, nil } fmt.Printf(\"Error connecting to the database (attempt %d/%d): %v\\n\", i+1, maxRetries, err) time.Sleep(retryDelay) } return nil, fmt.Errorf(\"failed to connect to the database after %d attempts\", maxRetries) } 2. Use Docker Healthchecks Docker provides a HEALTHCHECK instruction that can be used to inform Docker how to test a container to check its health status. This can be particularly useful in ensuring that dependent services only start when their prerequisites are fully operational.\nUpdate your docker-compose.yml:\nversion: '3' services: db: image: postgres:13 environment: POSTGRES_DB: myapp POSTGRES_USER: user POSTGRES_PASSWORD: password healthcheck: test: [\"CMD-SHELL\", \"pg_isready -U user -d myapp\"] interval: 10s timeout: 5s retries: 5 app: build: . depends_on: db: condition: service_healthy environment: DATABASE_URL: postgres://user:password@db:5432/myapp?sslmode=disable This configuration ensures that the app service only starts after the db service is healthy and ready to accept connections.\n3. Use a Startup Script Another approach is to use a startup script that checks for database availability before starting your Go application.\nCreate a start.sh script:\n#!/bin/sh set -e until PGPASSWORD=$POSTGRES_PASSWORD psql -h \"db\" -U \"user\" -d \"myapp\" -c '\\q'; do \u003e\u00262 echo \"Postgres is unavailable - sleeping\" sleep 1 done \u003e\u00262 echo \"Postgres is up - executing command\" exec \"$@\" Update your Dockerfile:\nFROM golang:1.16 WORKDIR /app COPY go.mod go.sum ./ RUN go mod download COPY . . RUN go build -o main . COPY start.sh /start.sh RUN chmod +x /start.sh CMD [\"/start.sh\", \"./main\"] Conclusion Race conditions between databases and applications in Docker environments represent a significant challenge in ensuring smooth and reliable application startup. The strategies presented here - retry logic, Docker healthchecks, and startup scripts - each offer unique advantages and can be applied based on your specific requirements.\nBy implementing these solutions, particularly the retry logic in your Go application, you create a more robust and fault-tolerant system. This approach not only addresses the immediate issue of the race condition but also makes your application more resilient to temporary network issues or database restarts during normal operation.\nRemember, in production environments, it’s often beneficial to implement a combination of these strategies. This multi-layered approach ensures the highest level of reliability and provides multiple safeguards against potential startup issues.\nUnderstanding and effectively managing these race conditions is crucial in developing stable, dependable containerized applications. By doing so, you enhance both the developer experience and the overall reliability of your application infrastructure.\n","wordCount":"1099","inLanguage":"en","datePublished":"2024-07-08T00:00:00Z","dateModified":"2024-07-08T00:00:00Z","author":{"@type":"Person","name":"Backend Byte"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://backendbyte.com/posts/2024-07-08-db-race-condition-notes-2024/"},"publisher":{"@type":"Organization","name":"Backend Byte","logo":{"@type":"ImageObject","url":"http://backendbyte.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://backendbyte.com/ accesskey=h title="Backend Byte (Alt + H)"><img src=http://backendbyte.com/logo.png alt aria-label=logo height=35>Backend Byte</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://backendbyte.com/ title=Home><span>Home</span></a></li><li><a href=http://backendbyte.com/archives/ title=Archives><span>Archives</span></a></li><li><a href=http://backendbyte.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://backendbyte.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://backendbyte.com/>Home</a>&nbsp;»&nbsp;<a href=http://backendbyte.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Race Condition between Database and Application in Docker Container</h1><div class=post-description>Exploring race conditions between database and application layers in Docker containers.</div><div class=post-meta><span title='2024-07-08 00:00:00 +0000 UTC'>July 8, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1099 words&nbsp;·&nbsp;Backend Byte</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#understanding-race-conditions>Understanding Race Conditions</a></li><li><a href=#the-database-application-race-condition-in-docker-a-deeper-look>The Database-Application Race Condition in Docker: A Deeper Look</a></li><li><a href=#example-scenario-with-go>Example Scenario with Go</a></li><li><a href=#strategies-to-mitigate-the-race-condition>Strategies to Mitigate the Race Condition</a><ul><li><a href=#1-implement-retry-logic>1. Implement Retry Logic</a></li><li><a href=#2-use-docker-healthchecks>2. Use Docker Healthchecks</a></li><li><a href=#3-use-a-startup-script>3. Use a Startup Script</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div><div class=post-content><p><img loading=lazy src=http://backendbyte.com/images/posts/2024/race-condition/race-condition.png alt="Race Condition between Database and Application in Docker Container"></p><p>In the realm of containerized applications, particularly those orchestrated with Docker, developers often encounter a subtle yet critical challenge: managing the startup sequence of interdependent services. One of the most common and potentially problematic scenarios is the race condition that can occur between a database container and an application container. This article will provide an in-depth exploration of this race condition, with a focus on Go-based applications, and offer strategies to mitigate it effectively.</p><h2 id=understanding-race-conditions>Understanding Race Conditions<a hidden class=anchor aria-hidden=true href=#understanding-race-conditions>#</a></h2><p>A race condition, in its essence, is a situation where the behavior of a system depends on the relative timing of events, particularly when those events don&rsquo;t occur in the intended or expected order. In concurrent systems, race conditions often manifest when two or more operations must execute in a specific sequence to function correctly, but the system doesn&rsquo;t guarantee this order.</p><h2 id=the-database-application-race-condition-in-docker-a-deeper-look>The Database-Application Race Condition in Docker: A Deeper Look<a hidden class=anchor aria-hidden=true href=#the-database-application-race-condition-in-docker-a-deeper-look>#</a></h2><p>When deploying a multi-container Docker application, typically comprising a database (such as PostgreSQL or MySQL) and an application server (in our case, a Go application), you might encounter a scenario where your application fails to start due to an inability to connect to the database. This failure is a classic example of a race condition in containerized environments.</p><p>To understand why this occurs, let&rsquo;s break down the startup process:</p><ol><li><p><strong>Concurrent Initialization</strong>: When you start your Docker Compose setup or deploy your containers, Docker initiates the startup of all defined services concurrently. This parallel initialization is generally beneficial for reducing overall startup time.</p></li><li><p><strong>Varying Startup Times</strong>: Different containers have different initialization requirements. A database container, for instance, needs to perform several operations before it&rsquo;s ready to accept connections:</p><ul><li>Initialize the database engine</li><li>Load configuration files</li><li>Allocate memory and resources</li><li>Create or recover database files</li><li>Start listening for connections</li></ul><p>On the other hand, an application container might only need to load its code into memory and start the server process.</p></li><li><p><strong>Eager Application Initialization</strong>: Most application code is written with the assumption that all required services (like databases) are available when the application starts. As soon as the application container starts, it typically attempts to establish a connection to the database.</p></li><li><p><strong>Timing Mismatch</strong>: Due to the difference in startup times, the application container often becomes operational before the database container is ready to accept connections. When the application attempts to connect to the database, it encounters an error because the database service isn&rsquo;t available yet.</p></li></ol><p>This mismatch in timing - where the application is ready before its critical dependency (the database) - is the essence of the race condition we&rsquo;re discussing.</p><h2 id=example-scenario-with-go>Example Scenario with Go<a hidden class=anchor aria-hidden=true href=#example-scenario-with-go>#</a></h2><p>Let&rsquo;s illustrate this with a Go application that connects to a PostgreSQL database.</p><p><code>docker-compose.yml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>db</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:13</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_DB</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_USER</span>: <span style=color:#ae81ff>user</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>password</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>app</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>db</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_URL</span>: <span style=color:#ae81ff>postgres://user:password@db:5432/myapp?sslmode=disable</span>
</span></span></code></pre></div><p><code>main.go</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;database/sql&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;github.com/lib/pq&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dbURL</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;DATABASE_URL&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>db</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#e6db74>&#34;postgres&#34;</span>, <span style=color:#a6e22e>dbURL</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Error opening database connection:&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Exit</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Ping</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Error connecting to the database:&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Exit</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Successfully connected to the database&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In this scenario, even though we&rsquo;ve used <code>depends_on</code> in the Docker Compose file, our Go application might still attempt to connect before the PostgreSQL database is ready to accept connections. This will result in a connection error, exemplifying the race condition.</p><h2 id=strategies-to-mitigate-the-race-condition>Strategies to Mitigate the Race Condition<a hidden class=anchor aria-hidden=true href=#strategies-to-mitigate-the-race-condition>#</a></h2><h3 id=1-implement-retry-logic>1. Implement Retry Logic<a hidden class=anchor aria-hidden=true href=#1-implement-retry-logic>#</a></h3><p>One robust approach is to implement retry logic in your Go application. This method allows your application to gracefully handle initial connection failures and retry until the database becomes available.</p><p>Updated <code>main.go</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;database/sql&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;github.com/lib/pq&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dbURL</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;DATABASE_URL&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>db</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>connectWithRetry</span>(<span style=color:#a6e22e>dbURL</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Failed to connect to database:&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Exit</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Successfully connected to the database&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>connectWithRetry</span>(<span style=color:#a6e22e>dbURL</span> <span style=color:#66d9ef>string</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>DB</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>DB</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>maxRetries</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>retryDelay</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>maxRetries</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>db</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#e6db74>&#34;postgres&#34;</span>, <span style=color:#a6e22e>dbURL</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error opening database connection (attempt %d/%d): %v\n&#34;</span>, <span style=color:#a6e22e>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>maxRetries</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>retryDelay</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Ping</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>db</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error connecting to the database (attempt %d/%d): %v\n&#34;</span>, <span style=color:#a6e22e>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>maxRetries</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>retryDelay</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to connect to the database after %d attempts&#34;</span>, <span style=color:#a6e22e>maxRetries</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-use-docker-healthchecks>2. Use Docker Healthchecks<a hidden class=anchor aria-hidden=true href=#2-use-docker-healthchecks>#</a></h3><p>Docker provides a <code>HEALTHCHECK</code> instruction that can be used to inform Docker how to test a container to check its health status. This can be particularly useful in ensuring that dependent services only start when their prerequisites are fully operational.</p><p>Update your <code>docker-compose.yml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>db</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:13</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_DB</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_USER</span>: <span style=color:#ae81ff>user</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>password</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>healthcheck</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>test</span>: [<span style=color:#e6db74>&#34;CMD-SHELL&#34;</span>, <span style=color:#e6db74>&#34;pg_isready -U user -d myapp&#34;</span>]
</span></span><span style=display:flex><span>      <span style=color:#f92672>interval</span>: <span style=color:#ae81ff>10s</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>retries</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>app</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>db</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>condition</span>: <span style=color:#ae81ff>service_healthy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_URL</span>: <span style=color:#ae81ff>postgres://user:password@db:5432/myapp?sslmode=disable</span>
</span></span></code></pre></div><p>This configuration ensures that the <code>app</code> service only starts after the <code>db</code> service is healthy and ready to accept connections.</p><h3 id=3-use-a-startup-script>3. Use a Startup Script<a hidden class=anchor aria-hidden=true href=#3-use-a-startup-script>#</a></h3><p>Another approach is to use a startup script that checks for database availability before starting your Go application.</p><p>Create a <code>start.sh</code> script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>until</span> PGPASSWORD<span style=color:#f92672>=</span>$POSTGRES_PASSWORD psql -h <span style=color:#e6db74>&#34;db&#34;</span> -U <span style=color:#e6db74>&#34;user&#34;</span> -d <span style=color:#e6db74>&#34;myapp&#34;</span> -c <span style=color:#e6db74>&#39;\q&#39;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  &gt;&amp;<span style=color:#ae81ff>2</span> echo <span style=color:#e6db74>&#34;Postgres is unavailable - sleeping&#34;</span>
</span></span><span style=display:flex><span>  sleep <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt;&amp;<span style=color:#ae81ff>2</span> echo <span style=color:#e6db74>&#34;Postgres is up - executing command&#34;</span>
</span></span><span style=display:flex><span>exec <span style=color:#e6db74>&#34;</span>$@<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>Update your <code>Dockerfile</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> golang:1.16</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> go.mod go.sum ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> go mod download<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> go build -o main .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> start.sh /start.sh<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> chmod +x /start.sh<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;/start.sh&#34;</span>, <span style=color:#e6db74>&#34;./main&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Race conditions between databases and applications in Docker environments represent a significant challenge in ensuring smooth and reliable application startup. The strategies presented here - retry logic, Docker healthchecks, and startup scripts - each offer unique advantages and can be applied based on your specific requirements.</p><p>By implementing these solutions, particularly the retry logic in your Go application, you create a more robust and fault-tolerant system. This approach not only addresses the immediate issue of the race condition but also makes your application more resilient to temporary network issues or database restarts during normal operation.</p><p>Remember, in production environments, it&rsquo;s often beneficial to implement a combination of these strategies. This multi-layered approach ensures the highest level of reliability and provides multiple safeguards against potential startup issues.</p><p>Understanding and effectively managing these race conditions is crucial in developing stable, dependable containerized applications. By doing so, you enhance both the developer experience and the overall reliability of your application infrastructure.</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://backendbyte.com/tags/db/>Db</a></li></ul><nav class=paginav><a class=prev href=http://backendbyte.com/posts/2024-07-08-postgres-bulk-insert-2024/><span class=title>« Prev</span><br><span>Optimizing PostgreSQL for Large-Scale Data Insertions: From INSERT to COPY and Beyond</span>
</a><a class=next href=http://backendbyte.com/posts/2024-05-18-argocd-deployment-notes-2024/><span class=title>Next »</span><br><span>ArgoCD configuration on Bare metal with nginx-ingress and cloudflare tunnel</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Race Condition between Database and Application in Docker Container on x" href="https://x.com/intent/tweet/?text=Race%20Condition%20between%20Database%20and%20Application%20in%20Docker%20Container&amp;url=http%3a%2f%2fbackendbyte.com%2fposts%2f2024-07-08-db-race-condition-notes-2024%2f&amp;hashtags=db"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Race Condition between Database and Application in Docker Container on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fbackendbyte.com%2fposts%2f2024-07-08-db-race-condition-notes-2024%2f&amp;title=Race%20Condition%20between%20Database%20and%20Application%20in%20Docker%20Container&amp;summary=Race%20Condition%20between%20Database%20and%20Application%20in%20Docker%20Container&amp;source=http%3a%2f%2fbackendbyte.com%2fposts%2f2024-07-08-db-race-condition-notes-2024%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Race Condition between Database and Application in Docker Container on reddit" href="https://reddit.com/submit?url=http%3a%2f%2fbackendbyte.com%2fposts%2f2024-07-08-db-race-condition-notes-2024%2f&title=Race%20Condition%20between%20Database%20and%20Application%20in%20Docker%20Container"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Race Condition between Database and Application in Docker Container on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fbackendbyte.com%2fposts%2f2024-07-08-db-race-condition-notes-2024%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Race Condition between Database and Application in Docker Container on whatsapp" href="https://api.whatsapp.com/send?text=Race%20Condition%20between%20Database%20and%20Application%20in%20Docker%20Container%20-%20http%3a%2f%2fbackendbyte.com%2fposts%2f2024-07-08-db-race-condition-notes-2024%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Race Condition between Database and Application in Docker Container on telegram" href="https://telegram.me/share/url?text=Race%20Condition%20between%20Database%20and%20Application%20in%20Docker%20Container&amp;url=http%3a%2f%2fbackendbyte.com%2fposts%2f2024-07-08-db-race-condition-notes-2024%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Race Condition between Database and Application in Docker Container on ycombinator" href="https://news.ycombinator.com/submitlink?t=Race%20Condition%20between%20Database%20and%20Application%20in%20Docker%20Container&u=http%3a%2f%2fbackendbyte.com%2fposts%2f2024-07-08-db-race-condition-notes-2024%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://backendbyte.com/>Backend Byte</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>